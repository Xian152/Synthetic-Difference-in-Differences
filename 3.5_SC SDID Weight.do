
***************************************************************	 
********************* 对SC和SDID加权，回到did package得到dynamic results ****************
***************************************************************	 
clear
input	dspcode sc_w11 sdid_w11	 sc_w12 sdid_w12	 sc_w14 sdid_w14		
110112	0	0.01836615	0	0.02078114	0	0.01985986
130302	0	0.02616123	0	0.01652302	0	0.01809245
130826	0	0.01574876	0	0.02218584	0	0.02135257
140826	0	0.00563438	0	0.02772858	0	0.02370005
150423	0	0.02145491	0	0.01908924	0	0.01829574
211021	0	0.0163601	0	0.02188881	0	0.01995295
220183	0	0.03578	0	0.01125466	0	0.01638837
220211	0	0.01716151	0	0.02144005	0	0.02077021
220582	0	0.03117578	0	0.01378317	0	0.01625169
230223	0	0.01962789	0	0.02008823	0	0.02020421
320831	0	0.02550267	0	0.01688069	0	0.0181558
320921	0	0.02718898	0	0.01594873	0	0.01924084
330702	0	0.01440338	0	0.02295418	0	0.0209407
340504	0	0.0208347	0	0.01942274	0	0.01928198
360727	0.71363935	0.03869336	0.14436621	0.00966985	0.24807166	0.01574894
360923	0	0.01287644	0	0.02377186	0	0.02306443
370684	0	0.01736249	0	0.0213301	0	0.01975712
371202	0	0.02595962	0	0.0166284	0	0.01875996
410102	0	0.01110507	0	0.02473501	0	0.02209691
410526	0	0.01825912	0	0.02082323	0	0.02065721
410782	0	0.05446132	0.08018458	0.00425463	0.03431689	0.01227385
411328	0	0.02717898	0	0.01594035	0	0.0185621
420503	0	0.00345755	0	0.02941058	0	0.0235161
430181	0	0.02210513	0	0.01874783	0	0.02004057
430626	0	0.01110405	0	0.02476422	0	0.02271372
441284	0	0.00400038	0	0.02862047	0	0.02508837
441424	0	0.03065798	0	0.01406125	0.00010105	0.02065944
450302	0.2145501	0.00405762	0.281531	0.02859327	0.41166641	0.02310841
450521	0	0.04372215	0	0.00692067	0	0.01353355
451027	0	0.01636613	0	0.02185044	0	0.02003306
510411	0	0.03946956	0	0.00924853	0	0.01429619
511325	0	0.00449323	0.35622789	0.03051746	0	0.02459218
511823	0	0.01606203	0	0.02204342	0	0.02091082
520302	0	0.01377487	0	0.02329632	0	0.02116838
520328	0	0.00614552	0	0.02746111	0	0.02308505
520622	0	0.0261611	0	0.01650249	0	0.01669317
530423	0	0.01045339	0	0.02509877	0	0.02304941
532627	0	0.01386384	0	0.0232322	0	0.02071738
532923	0	0.01308538	0	0.02363841	0	0.022557
533325	0	0.04837022	0	0.00436263	0	0.01375219
540222	0	0.0250351	0	0.01714358	0	0.02228273
610582	0	0.0164946	0	0.02181209	0	0.01973905
620503	0	0.03876211	0	0.00962645	0	0.01479261
620982	0	0.00524328	0	0.02794952	0.1318985	0.0256898
623021	0	0.0093714	0	0.02567464	0	0.02271066
630221	0	0.00470031	0	0.02824801	0	0.02311433
640104	0	0.03239112	0	0.01312136	0.00090559	0.01449897
652925	0	0.00748798	0	0.02672443	0	0.02263777
653125	0	0.01270075	0	0.02386299	0	0.02148435
653221	0.07181055	0.01916638	0.13769033	0.02034434	0.1730399	0.02012679
end
save "${OUT}/weight.dta",replace

use "${OUT}/final with 18 random select_fin2.dta",clear
	merge m:1 dspcode using "${OUT}/weight.dta"
	drop _m
	foreach k in sc_w11 sdid_w11{
		gen `k'_alt = `k'*9/35
	}

	foreach k in sc_w12 sdid_w12{
		gen `k'_alt = `k'*18/35
	}

	foreach k in sc_w14 sdid_w14{
		gen `k'_alt = `k'*8/36
	}

	foreach k in sc_w sdid_w{
		egen `k' = rowtotal(`k'11_alt `k'12_alt `k'14_alt)
	}

	keep dspcode year treated_g County treated2011 treated2012 treated2014 drinking30 treated sex prop_65 log_gdp g sc_w11 sdid_w11 sc_w12 sdid_w12 sc_w14 sdid_w14 sc_w sdid_w

	replace sdid_w = 1 if treated_g== 1 
	replace sc_w = 1 if treated_g== 1 

save "${OUT}/final with_weightsdid_2.dta",replace

use "${OUT}/final with_weightsdid_2.dta",clear
	keep dspcode sc_w11 sdid_w11 sc_w12 sdid_w12 sc_w14 sdid_w14 sc_w sdid_w County
	duplicates drop
	drop if  sdid_w == 1 
	
	
	
	
	
